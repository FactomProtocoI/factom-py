import unittest

from factom_core.blocks import AdminBlock


class TestAdminBlock(unittest.TestCase):

    # TODO: put this ABlock test data in its own file
    # The mainnet ABlock with the most entries: height 70417
    test_data = (
        "000000000000000000000000000000000000000000000000000000000000000a4a994fbc66747f91e28576e715de510bb129"
        "37ee68885ffc0a70ad3b03b375600001131100000000490000107706888888655866a003faabd999c7b0a7c908af17d63fd2"
        "ac2951dc99e1ad2a14f40001131208888888655866a003faabd999c7b0a7c908af17d63fd2ac2951dc99e1ad2a14f400f813"
        "9f98fadc948b254d0dea29c55fab7fa14f1fd97ef78ef7bb99d2d82bd6f10001131203888888655866a003faabd999c7b0a7"
        "c908af17d63fd2ac2951dc99e1ad2a14f486e2f9073dfafb461888955166c12c6b1d9aa98504af1cccb08f0ad53fbbb66609"
        "888888655866a003faabd999c7b0a7c908af17d63fd2ac2951dc99e1ad2a14f400005bf09c36ebb93643acf41e7162613575"
        "83ee728106888888dda15d7ad44c3286d66cc4f82e6fc07ed88de4d13ac9a182199593cac10001131208888888dda15d7ad4"
        "4c3286d66cc4f82e6fc07ed88de4d13ac9a182199593cac10007f339e556ee999cc7e33500753ea0933381b09f5c2bca26e2"
        "24d716e61a88620001131203888888dda15d7ad44c3286d66cc4f82e6fc07ed88de4d13ac9a182199593cac17c45e29fd0c7"
        "e09428e7ea60ed5042e8a0d6a091cc576e255eb10b7e899d3c0309888888dda15d7ad44c3286d66cc4f82e6fc07ed88de4d1"
        "3ac9a182199593cac100006788c85b7963c8527900a2a2ad2c24d15f347d89068888889585051d7117d217a55a366d56826e"
        "da35c951f02428b976524dbfc7f900011312088888889585051d7117d217a55a366d56826eda35c951f02428b976524dbfc7"
        "f9002001c69d076a5bf43335d41f49ad7626f1d79d8e1dfe9d9f9c8cc9a0d99efd5b00011312038888889585051d7117d217"
        "a55a366d56826eda35c951f02428b976524dbfc7f9914ab0fd1905f3ef19e54f94dd3caee1055793eb8cd5ce7f982cd15ea3"
        "93bcd7098888889585051d7117d217a55a366d56826eda35c951f02428b976524dbfc7f90000c568a1206e29c7c8fed15aee"
        "12515833434b4eb406888888bf5e39211db27b2d2b1b57606b4d68cf57e908971949a233d8eb7341560001131208888888bf"
        "5e39211db27b2d2b1b57606b4d68cf57e908971949a233d8eb73415600646f6bf2eaa80a803f1ffd3286945c4d6ddfdf5974"
        "177a52141c6906153f52370001131203888888bf5e39211db27b2d2b1b57606b4d68cf57e908971949a233d8eb7341560027"
        "62ccf5948b8e1c29a9c3df4748cf3efe6567eb3046e6361f353079e5534409888888bf5e39211db27b2d2b1b57606b4d68cf"
        "57e908971949a233d8eb73415600007c6b5121835d148932c75ce773208ffc17a4144f068888886ff14cef50365b785eb3ce"
        "fab5bc30175d022be06ed412391a8264537600011312088888886ff14cef50365b785eb3cefab5bc30175d022be06ed41239"
        "1a82645376000d6a22b9bf17851c830189fb324ba7d1ea8d6a15eea3adf671109825a133214700011312038888886ff14cef"
        "50365b785eb3cefab5bc30175d022be06ed412391a82645376fe21f1320ff7eaaab9ceb9551833078ab79b5b0dfe86097a88"
        "ca26d74e48b354098888886ff14cef50365b785eb3cefab5bc30175d022be06ed412391a826453760000b4db03e03da3555f"
        "630aef3900897e67247c847706888888b1255ea1cc0b3ab3b9425d3239643ae1f3c00ec634690eda784f05bda70001131208"
        "888888b1255ea1cc0b3ab3b9425d3239643ae1f3c00ec634690eda784f05bda700e3b88b704533612f69b5d6390737481694"
        "d7d8acb71e532cac3e8dd2d11ca6910001131203888888b1255ea1cc0b3ab3b9425d3239643ae1f3c00ec634690eda784f05"
        "bda71cbf54effa547cf89751e3a02d8980ea7e9325e591ff8f1d360bbe323da8fa5a09888888b1255ea1cc0b3ab3b9425d32"
        "39643ae1f3c00ec634690eda784f05bda70000dcb4dcd7e5a518854eadd0ec48955101d9fbac350688888841ac82c501a300"
        "def3e95d724b4b5e31f729f3b6d9d9736dca0f0edc34000113120888888841ac82c501a300def3e95d724b4b5e31f729f3b6"
        "d9d9736dca0f0edc3400667a53519cab0365d1a1ac625b6cd64d86695e8ae38d280ea6d3dbe8191acf340001131203888888"
        "41ac82c501a300def3e95d724b4b5e31f729f3b6d9d9736dca0f0edc3452103541ebcd32f5a55dc3c5037fd6396bbe3d65d2"
        "2f8c06026a9ad97440d8cd0988888841ac82c501a300def3e95d724b4b5e31f729f3b6d9d9736dca0f0edc3400005ba2689c"
        "372fdf712e477a83059a5da313e07bf0068888882fa588e8ad6e73555a9b9ff3d84b468601b81328ec09d91051369d737300"
        "011312088888882fa588e8ad6e73555a9b9ff3d84b468601b81328ec09d91051369d737300296d08be4a741d6c328ab47d80"
        "a55590dceef6550066a0a76e4816a3f51eefee00011312038888882fa588e8ad6e73555a9b9ff3d84b468601b81328ec09d9"
        "1051369d7373a5f91355b6c8a1a9b38d378434886caea05cc73e544416ec4c9b7f219f23c497098888882fa588e8ad6e7355"
        "5a9b9ff3d84b468601b81328ec09d91051369d73730000850fd39e1841b29c12f4ace379380a467489dba806888888b4eecb"
        "6868615e1875120e855529b4e372e2887cdec7185b46abfcfb350001131208888888b4eecb6868615e1875120e855529b4e3"
        "72e2887cdec7185b46abfcfb3500c2bbab9d274415765eae5c3ee3b94ff3c38dd5c9b02c8f842e2770a6de0b506800011312"
        "03888888b4eecb6868615e1875120e855529b4e372e2887cdec7185b46abfcfb3586400145400bf22a717d1bd4fc7f15e5de"
        "2872d21e815bc0a4916c15de2e6eb709888888b4eecb6868615e1875120e855529b4e372e2887cdec7185b46abfcfb350000"
        "e0e135c1ee0c2131b2dac5fcb353863ac21fff62068888884a0acbf1a23e3291b99681b80a91ca51914d64e39de65645868e"
        "0b471400011312088888884a0acbf1a23e3291b99681b80a91ca51914d64e39de65645868e0b47140093f6aca96b011fc31f"
        "d655fee9556b459509308eaaa63c02e9ebff8f384c72e000011312038888884a0acbf1a23e3291b99681b80a91ca51914d64"
        "e39de65645868e0b471435b100ead1d81fe3a3e6b1a656c127b14a2ef9d520adec6ea0d7b9d1d5488268098888884a0acbf1"
        "a23e3291b99681b80a91ca51914d64e39de65645868e0b4714000058e737d93cb52102d78ee7b918bd33a4412f901e068888"
        "88f05308313f6e8f5619cacfb32e0dcba25b4741de9c0fc3b127e8ba2a6b0001131208888888f05308313f6e8f5619cacfb3"
        "2e0dcba25b4741de9c0fc3b127e8ba2a6b006ceeb261cc19b14f6c89bb0bd937f195ffc9e6adaa5618e432752b01a00792c7"
        "0001131203888888f05308313f6e8f5619cacfb32e0dcba25b4741de9c0fc3b127e8ba2a6b8fcab189bbb2f97249d05b0b31"
        "adeaef23b7aaca326673e16fc901022f8285c809888888f05308313f6e8f5619cacfb32e0dcba25b4741de9c0fc3b127e8ba"
        "2a6b000057b3621913fd321c4c4f07cef3468bf04b0baf59068888881541fc5bc1bcc0597e71eed5df7de8d47c8eb97f867d"
        "16ebb20781f38b00011312088888881541fc5bc1bcc0597e71eed5df7de8d47c8eb97f867d16ebb20781f38b0034ffc2a7f6"
        "e35e503fd2d4259113d4d9b131e8e56d63a1c277ab5064d58d982600011312038888881541fc5bc1bcc0597e71eed5df7de8"
        "d47c8eb97f867d16ebb20781f38b1ce468172d6408643a8931838a935733f6fa97d02a8b44a741a1376da882915209888888"
        "1541fc5bc1bcc0597e71eed5df7de8d47c8eb97f867d16ebb20781f38b0000010c53bd5e4a863cf8e7df48f567e3f2e492ab"
        "a906888888c1fd1cf7ca3e0c4e2e9a6462aa8ac4e537563ee54ff41eb6b617a1ec370001131208888888c1fd1cf7ca3e0c4e"
        "2e9a6462aa8ac4e537563ee54ff41eb6b617a1ec3700b9a4837383cf11d818f1c1931f5586f840967fe0931d9b733394f75b"
        "f39fcd170001131203888888c1fd1cf7ca3e0c4e2e9a6462aa8ac4e537563ee54ff41eb6b617a1ec3796fa0827f28ced76f1"
        "8e42b8ef836d96c5c5adde4b8c98a406ad00610998562809888888c1fd1cf7ca3e0c4e2e9a6462aa8ac4e537563ee54ff41e"
        "b6b617a1ec3700001f605e0d687dbb731e6961cdf8c30e24195889d006888888b2ddad8c24fdf3033bdf6bd9c393ffe074b6"
        "f5d5741c84afea27c1656e0001131208888888b2ddad8c24fdf3033bdf6bd9c393ffe074b6f5d5741c84afea27c1656e00b1"
        "1d2c22e96af34946810c816ada60a7027ed3d7c98aac72283ed348fc58cf730001131203888888b2ddad8c24fdf3033bdf6b"
        "d9c393ffe074b6f5d5741c84afea27c1656e74055ead8eb83d34515c66bb7824dfda3659e1193dd31f6f38eed6e2cdc4e592"
        "09888888b2ddad8c24fdf3033bdf6bd9c393ffe074b6f5d5741c84afea27c1656e000072f4aa05adc0b5284602bd74485810"
        "6c618b932e06888888a8da713519881065d90f73f498b36d956e3390c5a6c06747922395075f0001131208888888a8da7135"
        "19881065d90f73f498b36d956e3390c5a6c06747922395075f00ffb9efd4d490535e3b5041622354f5c440524b0d1976582e"
        "0c9ba6cb1649279b0001131203888888a8da713519881065d90f73f498b36d956e3390c5a6c06747922395075f36108e2fd7"
        "ba67a25886c14408db1bc2a1d0098a23f2b64e4734ff80b772def009888888a8da713519881065d90f73f498b36d956e3390"
        "c5a6c06747922395075f00003d5ffebea388ce494cd7d24ff03165117561ef9006888888a5ce32a3a257c1ff29033b6c01dd"
        "20239e7c68ebaf06d690e4ae2b7e830001131208888888a5ce32a3a257c1ff29033b6c01dd20239e7c68ebaf06d690e4ae2b"
        "7e830013d42208f7a7699c7976dc19424872268e503779850fb72aecae4b5341dd40c70001131203888888a5ce32a3a257c1"
        "ff29033b6c01dd20239e7c68ebaf06d690e4ae2b7e83611fb3b711629ee6964f6e6d7a7a389ab275b4b14c8eafaaa72930f2"
        "b9c1230309888888a5ce32a3a257c1ff29033b6c01dd20239e7c68ebaf06d690e4ae2b7e830000412945af7b4ec2ff17285b"
        "22631be19f3201d572068888886043746fe47dcf55952b20d8aee6ae842024010fd3f42bc0076a502f420001131208888888"
        "6043746fe47dcf55952b20d8aee6ae842024010fd3f42bc0076a502f4200847ef7a9d15df05940a97030a7b783fad54622bd"
        "b81f5698f948b94e127eb6e500011312038888886043746fe47dcf55952b20d8aee6ae842024010fd3f42bc0076a502f42b5"
        "66f30f2013dc3cf7960268da70efb76534ce710f270c1b3ae08781f9faae1b098888886043746fe47dcf55952b20d8aee6ae"
        "842024010fd3f42bc0076a502f420000e2a977f66a529d3746727f390c429298f6daef680688888870cf06fb3ed94af3ba91"
        "7dbe9fab73391915c57812bd6606e6ced76d53000113120888888870cf06fb3ed94af3ba917dbe9fab73391915c57812bd66"
        "06e6ced76d53005413e626ce80d90276b5b2388d13f4a4dce2faffce6bb76b9290fcd11dd700dc000113120388888870cf06"
        "fb3ed94af3ba917dbe9fab73391915c57812bd6606e6ced76d53151253cf6f9ad8db3f1bd7116a6ec894851fff4268ad1c14"
        "fe3ce8f3933a9b080988888870cf06fb3ed94af3ba917dbe9fab73391915c57812bd6606e6ced76d53000080b560002d8515"
        "4fa1c255531c232f84b4293c860100000000000000000000000000000000000000000000000000000000000000000426a802"
        "617848d4d16d87830fc521f4d136bb2d0c352850919c2679f189613a9c798bf48022895c046a4e780fc43a4f112d90d7988"
        "9a335ea88336e1cb01e47862bb4504a70cdd3055c9718b2b68166142229f66d772cccb2cac5e5b8dd6c09"
    )

    def test_unmarshal(self):
        expected_back_reference_hash = (
            "4a994fbc66747f91e28576e715de510bb12937ee68885ffc0a70ad3b03b37560"
        )
        expected_height = 70417
        expected_header_expansion_area = ""
        expected_message_count = 73

        block = AdminBlock.unmarshal(bytes.fromhex(TestAdminBlock.test_data))
        assert block.header.back_reference_hash.hex() == expected_back_reference_hash
        assert block.header.height == expected_height
        assert block.header.expansion_area.hex() == expected_header_expansion_area
        assert block.header.message_count == expected_message_count
        assert len(block.messages) == expected_message_count

    def test_marshal(self):
        block = AdminBlock.unmarshal(bytes.fromhex(TestAdminBlock.test_data))
        assert block.marshal().hex() == TestAdminBlock.test_data

    def test_lookup_hash(self):
        expected_lookup_hash = (
            "748a13e79aa35130ea193141ee7849b5cc7ffcceb1aa77d58cb62c129170ca79"
        )
        block = AdminBlock.unmarshal(bytes.fromhex(TestAdminBlock.test_data))
        assert block.lookup_hash.hex() == expected_lookup_hash, "{} != {}".format(
            block.lookup_hash.hex(), expected_lookup_hash
        )
